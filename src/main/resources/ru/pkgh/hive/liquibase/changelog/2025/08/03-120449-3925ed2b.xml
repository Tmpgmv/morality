<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd"
        objectQuotingStrategy="QUOTE_ONLY_RESERVED_WORDS">
    <changeSet id="1" author="hive">
        <createTable tableName="HIVE_ACCEPTANCE_OF_STATMENT_OF_EXPLANATION">
            <column name="ID" type="UUID">
                <constraints nullable="false" primaryKey="true"
                             primaryKeyName="PK_HIVE_ACCEPTANCE_OF_STATMENT_OF_EXPLANATION"/>
            </column>
            <column name="CREATED_AT" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="EMPLOYEE_ID" type="UUID">
                <constraints nullable="false"/>
            </column>
            <column name="COMMENT_" type="CLOB"/>
        </createTable>
    </changeSet>
    <changeSet id="2" author="hive">
        <createTable tableName="HIVE_MERCY">
            <column name="ID" type="UUID">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_HIVE_MERCY"/>
            </column>
            <column name="EMPLOYEE_ID" type="UUID">
                <constraints nullable="false"/>
            </column>
            <column name="CREATED_AT" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="PROMISE_ID" type="UUID">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="3" author="hive">
        <createTable tableName="HIVE_MISDEMEANOR">
            <column name="ID" type="UUID">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_HIVE_MISDEMEANOR"/>
            </column>
            <column name="TYPE_ID" type="UUID">
                <constraints nullable="false"/>
            </column>
            <column name="CASE_SUMMARY" type="CLOB">
                <constraints nullable="false"/>
            </column>
            <column name="REFERRER_ID" remarks="Сотрудник, который рапортует о проступке." type="UUID">
                <constraints nullable="false"/>
            </column>
            <column name="FLAG" remarks="Просто флаг. Чтобы пользователь мог маркировать проступок." type="BOOLEAN"/>
            <column name="CREATED_AT" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="COMMENT_" type="CLOB"/>
            <column name="STUDENT_ID" type="UUID">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="4" author="hive">
        <createTable
                remarks="Коллекция обещаний. Текст обещания не важен.&#10;Важен сам факт раскаяния и обещания исправиться.&#10;Поэтому в этой коллекции желательно иметь&#10;пословицы и поговорки. Например, &quot;Мое слово тверже гороха&quot;.&#10;Пользователи увидят такие тексты. И это позволит все-таки немножко разрядить&#10;обстановку."
                tableName="HIVE_OATH">
            <column name="ID" type="UUID">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_HIVE_OATH"/>
            </column>
            <column name="TEXT" type="VARCHAR(1000)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="5" author="hive">
        <createTable remarks="Студент упустил время отреагировать на обвинение. Разрешить ему это сделать."
                     tableName="HIVE_PERMIT_TO_PROMISE">
            <column name="ID" type="UUID">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_HIVE_PERMIT_TO_PROMISE"/>
            </column>
            <column name="PROMISE_ID" type="UUID">
                <constraints nullable="false"/>
            </column>
            <column name="CREATED_AT" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="EMPLOYEE_ID" type="UUID">
                <constraints nullable="false"/>
            </column>
            <column name="COMMENT_" type="CLOB"/>
        </createTable>
    </changeSet>
    <changeSet id="6" author="hive">
        <createTable
                remarks="Обещание не повторять прступок.&#10;&#10;Один из вариантов ответа студента на обвинение&#10;(см. комментарий к StatementOfExplanation).&#10;&#10;Текст обещания не важен. Важен сам факт обещания."
                tableName="HIVE_PROMISE">
            <column name="ID" type="UUID">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_HIVE_PROMISE"/>
            </column>
            <column name="CREATED_AT" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="TEXT" remarks="Текст обещания неважен. Важен сам факт обещания." type="CLOB">
                <constraints nullable="false"/>
            </column>
            <column name="STUDENT_ID" type="UUID">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="7" author="hive">
        <createTable remarks="Отклонение объяснительной" tableName="HIVE_REJECTION_OF_STATEMENT_OF_EXPLANATION">
            <column name="ID" type="UUID">
                <constraints nullable="false" primaryKey="true"
                             primaryKeyName="PK_HIVE_REJECTION_OF_STATEMENT_OF_EXPLANATION"/>
            </column>
            <column name="CREATED_AT" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="COMMENT_" type="CLOB"/>
            <column name="EMPLOYEE_ID" type="UUID">
                <constraints nullable="false"/>
            </column>
            <column name="MESSAGE" remarks="Сообщение студенту." type="CLOB"/>
        </createTable>
    </changeSet>
    <changeSet id="8" author="hive">
        <createTable tableName="HIVE_SETTINGS">
            <column name="ID" type="UUID">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_HIVE_SETTINGS"/>
            </column>
            <column name="TIME_FOR_STUDENT_TO_REACT"
                    remarks="Время, в течение которого студент может отреагировать. В часах." type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="9" author="hive">
        <createTable remarks="Объяснительная.&#10;Студент заявляет о безосновательности обвинения."
                     tableName="HIVE_STATEMENT_OF_EXPLANATION">
            <column name="ID" type="UUID">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_HIVE_STATEMENT_OF_EXPLANATION"/>
            </column>
            <column name="CREATED_AT" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="STUDENT_ID" type="UUID">
                <constraints nullable="false"/>
            </column>
            <column name="TEXT" type="CLOB"/>
        </createTable>
    </changeSet>
    <changeSet id="10" author="hive">
        <createTable tableName="HIVE_STUDENT">
            <column name="ID" type="UUID">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_HIVE_STUDENT"/>
            </column>
            <column name="USER_ID" type="UUID">
                <constraints nullable="false"/>
            </column>
            <column name="IDENTITY_CARD" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="11" author="hive">
        <createTable remarks="Тип проступка." tableName="HIVE_TYPE_OF_MISDEMEANOR">
            <column name="ID" type="UUID">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_HIVE_TYPE_OF_MISDEMEANOR"/>
            </column>
            <column name="NAME"
                    remarks="Наименование типа проступка.&#10;Это может быть прогул, опоздание, нарушение дисциплины."
                    type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="REACTION" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="COMMENT_" type="CLOB"/>
        </createTable>
    </changeSet>
    <changeSet id="12" author="hive">
        <createIndex indexName="IDX_HIVE_ACCEPTANCE_OF_STATMENT_OF_EXPLANATION_EMPLOYEE"
                     tableName="HIVE_ACCEPTANCE_OF_STATMENT_OF_EXPLANATION">
            <column name="EMPLOYEE_ID"/>
        </createIndex>

        <addForeignKeyConstraint baseColumnNames="EMPLOYEE_ID"
                                 baseTableName="HIVE_ACCEPTANCE_OF_STATMENT_OF_EXPLANATION"
                                 constraintName="FK_HIVE_ACCEPTANCE_OF_STATMENT_OF_EXPLANATION_ON_EMPLOYEE"
                                 referencedColumnNames="ID" referencedTableName="HIVE_USER"/>
    </changeSet>
    <changeSet id="13" author="hive">
        <createIndex indexName="IDX_HIVE_MERCY_EMPLOYEE" tableName="HIVE_MERCY">
            <column name="EMPLOYEE_ID"/>
        </createIndex>

        <addForeignKeyConstraint baseColumnNames="EMPLOYEE_ID" baseTableName="HIVE_MERCY"
                                 constraintName="FK_HIVE_MERCY_ON_EMPLOYEE" referencedColumnNames="ID"
                                 referencedTableName="HIVE_USER"/>
    </changeSet>
    <changeSet id="14" author="hive">
        <createIndex indexName="IDX_HIVE_MERCY_PROMISE" tableName="HIVE_MERCY">
            <column name="PROMISE_ID"/>
        </createIndex>

        <addForeignKeyConstraint baseColumnNames="PROMISE_ID" baseTableName="HIVE_MERCY"
                                 constraintName="FK_HIVE_MERCY_ON_PROMISE" referencedColumnNames="ID"
                                 referencedTableName="HIVE_PROMISE"/>
    </changeSet>
    <changeSet id="15" author="hive">
        <createIndex indexName="IDX_HIVE_MISDEMEANOR_STUDENT" tableName="HIVE_MISDEMEANOR">
            <column name="STUDENT_ID"/>
        </createIndex>

        <addForeignKeyConstraint baseColumnNames="STUDENT_ID" baseTableName="HIVE_MISDEMEANOR"
                                 constraintName="FK_HIVE_MISDEMEANOR_ON_STUDENT" onDelete="CASCADE"
                                 referencedColumnNames="ID" referencedTableName="HIVE_STUDENT"/>
    </changeSet>
    <changeSet id="16" author="hive">
        <createIndex indexName="IDX_HIVE_MISDEMEANOR_TYPE" tableName="HIVE_MISDEMEANOR">
            <column name="TYPE_ID"/>
        </createIndex>

        <addForeignKeyConstraint baseColumnNames="TYPE_ID" baseTableName="HIVE_MISDEMEANOR"
                                 constraintName="FK_HIVE_MISDEMEANOR_ON_TYPE" referencedColumnNames="ID"
                                 referencedTableName="HIVE_TYPE_OF_MISDEMEANOR"/>
    </changeSet>
    <changeSet id="17" author="hive">
        <createIndex indexName="IDX_HIVE_PERMIT_TO_PROMISE_EMPLOYEE" tableName="HIVE_PERMIT_TO_PROMISE">
            <column name="EMPLOYEE_ID"/>
        </createIndex>

        <addForeignKeyConstraint baseColumnNames="EMPLOYEE_ID" baseTableName="HIVE_PERMIT_TO_PROMISE"
                                 constraintName="FK_HIVE_PERMIT_TO_PROMISE_ON_EMPLOYEE" referencedColumnNames="ID"
                                 referencedTableName="HIVE_USER"/>
    </changeSet>
    <changeSet id="18" author="hive">
        <createIndex indexName="IDX_HIVE_PERMIT_TO_PROMISE_PROMISE" tableName="HIVE_PERMIT_TO_PROMISE">
            <column name="PROMISE_ID"/>
        </createIndex>

        <addForeignKeyConstraint baseColumnNames="PROMISE_ID" baseTableName="HIVE_PERMIT_TO_PROMISE"
                                 constraintName="FK_HIVE_PERMIT_TO_PROMISE_ON_PROMISE" referencedColumnNames="ID"
                                 referencedTableName="HIVE_MISDEMEANOR"/>
    </changeSet>
    <changeSet id="19" author="hive">
        <createIndex indexName="IDX_HIVE_PROMISE_STUDENT" tableName="HIVE_PROMISE">
            <column name="STUDENT_ID"/>
        </createIndex>

        <addForeignKeyConstraint baseColumnNames="STUDENT_ID" baseTableName="HIVE_PROMISE"
                                 constraintName="FK_HIVE_PROMISE_ON_STUDENT" onDelete="CASCADE"
                                 referencedColumnNames="ID" referencedTableName="HIVE_STUDENT"/>
    </changeSet>
    <changeSet id="20" author="hive">
        <createIndex indexName="IDX_HIVE_REJECTION_OF_STATEMENT_OF_EXPLANATION_EMPLOYEE"
                     tableName="HIVE_REJECTION_OF_STATEMENT_OF_EXPLANATION">
            <column name="EMPLOYEE_ID"/>
        </createIndex>

        <addForeignKeyConstraint baseColumnNames="EMPLOYEE_ID"
                                 baseTableName="HIVE_REJECTION_OF_STATEMENT_OF_EXPLANATION"
                                 constraintName="FK_HIVE_REJECTION_OF_STATEMENT_OF_EXPLANATION_ON_EMPLOYEE"
                                 referencedColumnNames="ID" referencedTableName="HIVE_USER"/>
    </changeSet>
    <changeSet id="21" author="hive">
        <createIndex indexName="IDX_HIVE_STATEMENT_OF_EXPLANATION_STUDENT" tableName="HIVE_STATEMENT_OF_EXPLANATION">
            <column name="STUDENT_ID"/>
        </createIndex>

        <addForeignKeyConstraint baseColumnNames="STUDENT_ID" baseTableName="HIVE_STATEMENT_OF_EXPLANATION"
                                 constraintName="FK_HIVE_STATEMENT_OF_EXPLANATION_ON_STUDENT" onDelete="CASCADE"
                                 referencedColumnNames="ID" referencedTableName="HIVE_STUDENT"/>
    </changeSet>
    <changeSet id="22" author="hive">
        <createIndex indexName="IDX_HIVE_STUDENT_USER" tableName="HIVE_STUDENT">
            <column name="USER_ID"/>
        </createIndex>

        <addForeignKeyConstraint baseColumnNames="USER_ID" baseTableName="HIVE_STUDENT"
                                 constraintName="FK_HIVE_STUDENT_ON_USER" referencedColumnNames="ID"
                                 referencedTableName="HIVE_USER"/>
    </changeSet>
    <changeSet id="23" author="hive">
        <addForeignKeyConstraint baseColumnNames="REFERRER_ID" baseTableName="HIVE_MISDEMEANOR"
                                 constraintName="FK_HIVE_MISDEMEANOR_ON_REFERRER" referencedColumnNames="ID"
                                 referencedTableName="HIVE_USER"/>
    </changeSet>
</databaseChangeLog>