<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd"
        objectQuotingStrategy="QUOTE_ONLY_RESERVED_WORDS">
    <changeSet id="1" author="hive">
        <createTable remarks="Учебная группа." tableName="HIVE_STUDY_GROUP">
            <column name="ID" type="UUID">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_HIVE_STUDY_GROUP"/>
            </column>
            <column name="NAME" remarks="Наименование группы. Например, ИР-23-3." type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="2" author="hive">
        <addColumn tableName="HIVE_REJECTION_OF_PROMISE">
            <column name="COMMENT_" remarks="Комментарий." type="CLOB"/>
        </addColumn>
    </changeSet>
    <changeSet id="3" author="hive">
        <addColumn tableName="HIVE_WARNING">
            <column name="COMMENT_" remarks="Комментарий." type="CLOB"/>
        </addColumn>
    </changeSet>
    <changeSet id="4" author="hive">
        <addColumn tableName="HIVE_WARNING">
            <column name="CREATED_AT" remarks="Время создания." type="DATETIME"/>
        </addColumn>

        <addNotNullConstraint columnName="CREATED_AT" defaultNullValue="now()" tableName="HIVE_WARNING"/>
    </changeSet>
    <changeSet id="5" author="hive">
        <addColumn tableName="HIVE_WARNING">
            <column name="EMPLOYEE_ID" remarks="Сотрудник, выносящий предупреждение." type="UUID"/>
        </addColumn>

        <addNotNullConstraint columnName="EMPLOYEE_ID" tableName="HIVE_WARNING"/>
    </changeSet>
    <changeSet id="6" author="hive">
        <addColumn tableName="HIVE_REJECTION_OF_PROMISE">
            <column name="MESSAGE" remarks="Сообщение студенту. Нельзя отклонить обещание, ничего не сообщив студенту."
                    type="VARCHAR(255)"/>
        </addColumn>

        <addNotNullConstraint columnName="MESSAGE" defaultNullValue="''" tableName="HIVE_REJECTION_OF_PROMISE"/>
    </changeSet>
    <changeSet id="7" author="hive">
        <addColumn tableName="HIVE_WARNING">
            <column name="MISDEMEANOR_ID" remarks="Ссылка на проступок." type="UUID"/>
        </addColumn>

        <addNotNullConstraint columnName="MISDEMEANOR_ID" tableName="HIVE_WARNING"/>
    </changeSet>
    <changeSet id="8" author="hive">
        <addColumn tableName="HIVE_SETTINGS">
            <column name="NUMBER_OF_WARNINGS_BEFORE_REPRIMAND" remarks="Сколько предупреждений до выговора. Шт."
                    type="INT"/>
        </addColumn>

        <addNotNullConstraint columnName="NUMBER_OF_WARNINGS_BEFORE_REPRIMAND" defaultNullValue="0"
                              tableName="HIVE_SETTINGS"/>
    </changeSet>
    <changeSet id="9" author="hive">
        <addColumn tableName="HIVE_REPRIMAND">
            <column name="TYPE_OF_MISDEMEANOR_ID"
                    remarks="Тип проступка. Приведен для удобства сортировок.&#10;Т.е. дублирование, т.к. информация о типе проступка содержится&#10;в проступке (поле misdemeanor)."
                    type="UUID"/>
        </addColumn>

        <addNotNullConstraint columnName="TYPE_OF_MISDEMEANOR_ID" tableName="HIVE_REPRIMAND"/>
    </changeSet>
    <changeSet id="10" author="hive">
        <addColumn tableName="HIVE_WARNING">
            <column name="TYPE_OF_MISDEMEANOR_ID"
                    remarks="Тип проступка. Приведен для удобства сортировок.&#10;Т.е. дублирование, т.к. информация о типе проступка содержится&#10;в проступке (поле misdemeanor)."
                    type="UUID"/>
        </addColumn>

        <addNotNullConstraint columnName="TYPE_OF_MISDEMEANOR_ID" tableName="HIVE_WARNING"/>
    </changeSet>
    <changeSet id="11" author="hive">
        <createIndex indexName="IDX_HIVE_REPRIMAND_TYPE_OF_MISDEMEANOR" tableName="HIVE_REPRIMAND">
            <column name="TYPE_OF_MISDEMEANOR_ID"/>
        </createIndex>

        <addForeignKeyConstraint baseColumnNames="TYPE_OF_MISDEMEANOR_ID" baseTableName="HIVE_REPRIMAND"
                                 constraintName="FK_HIVE_REPRIMAND_ON_TYPE_OF_MISDEMEANOR" referencedColumnNames="ID"
                                 referencedTableName="HIVE_TYPE_OF_MISDEMEANOR"/>
    </changeSet>
    <changeSet id="12" author="hive">
        <createIndex indexName="IDX_HIVE_WARNING_EMPLOYEE" tableName="HIVE_WARNING">
            <column name="EMPLOYEE_ID"/>
        </createIndex>

        <addForeignKeyConstraint baseColumnNames="EMPLOYEE_ID" baseTableName="HIVE_WARNING"
                                 constraintName="FK_HIVE_WARNING_ON_EMPLOYEE" referencedColumnNames="ID"
                                 referencedTableName="HIVE_USER"/>
    </changeSet>
    <changeSet id="13" author="hive">
        <createIndex indexName="IDX_HIVE_WARNING_MISDEMEANOR" tableName="HIVE_WARNING">
            <column name="MISDEMEANOR_ID"/>
        </createIndex>

        <addForeignKeyConstraint baseColumnNames="MISDEMEANOR_ID" baseTableName="HIVE_WARNING"
                                 constraintName="FK_HIVE_WARNING_ON_MISDEMEANOR" referencedColumnNames="ID"
                                 referencedTableName="HIVE_MISDEMEANOR"/>
    </changeSet>
    <changeSet id="14" author="hive">
        <createIndex indexName="IDX_HIVE_WARNING_TYPE_OF_MISDEMEANOR" tableName="HIVE_WARNING">
            <column name="TYPE_OF_MISDEMEANOR_ID"/>
        </createIndex>

        <addForeignKeyConstraint baseColumnNames="TYPE_OF_MISDEMEANOR_ID" baseTableName="HIVE_WARNING"
                                 constraintName="FK_HIVE_WARNING_ON_TYPE_OF_MISDEMEANOR" referencedColumnNames="ID"
                                 referencedTableName="HIVE_TYPE_OF_MISDEMEANOR"/>
    </changeSet>
    <changeSet id="15" author="hive">
        <setTableRemarks
                remarks="Прощение. За конкретный проступок стуеднт прощен.&#10;В характеристику упомянутый в обещании проступок не попадет."
                tableName="HIVE_MERCY"/>
    </changeSet>
    <changeSet id="16" author="hive">
        <setTableRemarks remarks="Проступок студента." tableName="HIVE_MISDEMEANOR"/>
    </changeSet>
    <changeSet id="17" author="hive">
        <setTableRemarks
                remarks="Коллекция типовых обещаний. В этой коллекции желательно иметь&#10;пословицы и поговорки. Например, &quot;Мое слово тверже гороха&quot;.&#10;Пользователи увидят такие тексты. И это позволит все-таки немножко разрядить&#10;обстановку."
                tableName="HIVE_OATH"/>
    </changeSet>
    <changeSet id="18" author="hive">
        <setTableRemarks
                remarks="Разрешение отреагировать на фиксацию проступка.&#10;Применяется, если студент упустил время, данное на то, чтобы отреагировать&#10;на обвинение.&#10;Иначе говоря, время уже прошло, но студенту разрешаем добавить&#10;обещание или объяснительную записку."
                tableName="HIVE_PERMIT_TO_PROMISE"/>
    </changeSet>
    <changeSet id="19" author="hive">
        <setTableRemarks remarks="Непринятие обещания. Т.е. студент понесет наказание за проступок."
                         tableName="HIVE_REJECTION_OF_PROMISE"/>
    </changeSet>
    <changeSet id="20" author="hive">
        <setTableRemarks
                remarks="Отклонение объяснительной записки.&#10;Т.е. доводы признаны неубедительными.&#10;И студент понесет наказание."
                tableName="HIVE_REJECTION_OF_STATEMENT_OF_EXPLANATION"/>
    </changeSet>
    <changeSet id="21" author="hive">
        <setTableRemarks
                remarks="Объявленный студенту выговор. На основании выговоров составляется характеристика студента."
                tableName="HIVE_REPRIMAND"/>
    </changeSet>
    <changeSet id="22" author="hive">
        <setTableRemarks remarks="Настройки программы." tableName="HIVE_SETTINGS"/>
    </changeSet>
    <changeSet id="23" author="hive">
        <setTableRemarks
                remarks="Объяснительная записка.&#10;Студент приводит уважительную причину или сообщает о несправедливости обвинений.&#10;В иных случаях писать объяснительную записку смысла нет."
                tableName="HIVE_STATEMENT_OF_EXPLANATION"/>
    </changeSet>
    <changeSet id="24" author="hive">
        <setTableRemarks remarks="Студент." tableName="HIVE_STUDENT"/>
    </changeSet>
    <changeSet id="25" author="hive">
        <setTableRemarks remarks="Предупреждение." tableName="HIVE_WARNING"/>
    </changeSet>
    <changeSet id="26" author="hive">
        <setColumnRemarks columnDataType="clob" columnName="COMMENT_" remarks="Комментарий."
                          tableName="HIVE_ACCEPTANCE_OF_STATMENT_OF_EXPLANATION"/>
    </changeSet>
    <changeSet id="27" author="hive">
        <setColumnRemarks columnDataType="clob" columnName="COMMENT_" remarks="Комментарий."
                          tableName="HIVE_PERMIT_TO_PROMISE"/>
    </changeSet>
    <changeSet id="28" author="hive">
        <setColumnRemarks columnDataType="clob" columnName="COMMENT_" remarks="Комментарий."
                          tableName="HIVE_REJECTION_OF_STATEMENT_OF_EXPLANATION"/>
    </changeSet>
    <changeSet id="29" author="hive">
        <setColumnRemarks columnDataType="clob" columnName="COMMENT_" remarks="Комментарий."
                          tableName="HIVE_REPRIMAND"/>
    </changeSet>
    <changeSet id="30" author="hive">
        <setColumnRemarks columnDataType="datetime" columnName="CREATED_AT" remarks="Время создания."
                          tableName="HIVE_FLAGGED_MISDEMEANOR"/>
    </changeSet>
    <changeSet id="31" author="hive">
        <setColumnRemarks columnDataType="datetime" columnName="CREATED_AT" remarks="Время создания."
                          tableName="HIVE_PERMIT_TO_PROMISE"/>
    </changeSet>
    <changeSet id="32" author="hive">
        <setColumnRemarks columnDataType="datetime" columnName="CREATED_AT" remarks="Время создания."
                          tableName="HIVE_PROMISE"/>
    </changeSet>
    <changeSet id="33" author="hive">
        <setColumnRemarks columnDataType="datetime" columnName="CREATED_AT" remarks="Времся создания."
                          tableName="HIVE_REJECTION_OF_STATEMENT_OF_EXPLANATION"/>
    </changeSet>
    <changeSet id="34" author="hive">
        <setColumnRemarks columnDataType="datetime" columnName="CREATED_AT" remarks="Время создания."
                          tableName="HIVE_REPRIMAND"/>
    </changeSet>
    <changeSet id="35" author="hive">
        <setColumnRemarks columnDataType="datetime" columnName="CREATED_AT" remarks="Время создания."
                          tableName="HIVE_STATEMENT_OF_EXPLANATION"/>
    </changeSet>
    <changeSet id="36" author="hive">
        <setColumnRemarks columnDataType="uuid" columnName="EMPLOYEE_ID"
                          remarks="Сотрудник, признавший пояснитульную записку студента обоснованной."
                          tableName="HIVE_ACCEPTANCE_OF_STATMENT_OF_EXPLANATION"/>
    </changeSet>
    <changeSet id="37" author="hive">
        <setColumnRemarks columnDataType="uuid" columnName="EMPLOYEE_ID"
                          remarks="Пользователь, пометивший для себя проступок студента флагом."
                          tableName="HIVE_FLAGGED_MISDEMEANOR"/>
    </changeSet>
    <changeSet id="38" author="hive">
        <setColumnRemarks columnDataType="uuid" columnName="EMPLOYEE_ID"
                          remarks="Ссылка на сотрудника, простившего студента." tableName="HIVE_MERCY"/>
    </changeSet>
    <changeSet id="39" author="hive">
        <setColumnRemarks columnDataType="uuid" columnName="EMPLOYEE_ID" remarks="Сотрудник, давший разрешение."
                          tableName="HIVE_PERMIT_TO_PROMISE"/>
    </changeSet>
    <changeSet id="40" author="hive">
        <setColumnRemarks columnDataType="uuid" columnName="EMPLOYEE_ID" remarks="Ссылка на сотрудника."
                          tableName="HIVE_REJECTION_OF_PROMISE"/>
    </changeSet>
    <changeSet id="41" author="hive">
        <setColumnRemarks columnDataType="uuid" columnName="EMPLOYEE_ID"
                          remarks="Ссылка на сотрудника, признавшего пояснительную записку неубедительной."
                          tableName="HIVE_REJECTION_OF_STATEMENT_OF_EXPLANATION"/>
    </changeSet>
    <changeSet id="42" author="hive">
        <setColumnRemarks columnDataType="uuid" columnName="EMPLOYEE_ID" remarks="Сотрудник, объявивший выговор."
                          tableName="HIVE_REPRIMAND"/>
    </changeSet>
    <changeSet id="43" author="hive">
        <setColumnRemarks columnDataType="varchar(255)" columnName="IDENTITY_CARD" remarks="Номер студенческого билета."
                          tableName="HIVE_STUDENT"/>
    </changeSet>
    <changeSet id="44" author="hive">
        <addNotNullConstraint columnDataType="CLOB" columnName="MESSAGE"
                              tableName="HIVE_REJECTION_OF_STATEMENT_OF_EXPLANATION" validate="true"/>
    </changeSet>
    <changeSet id="45" author="hive">
        <setColumnRemarks columnDataType="clob" columnName="MESSAGE"
                          remarks="Сообщение студенту.&#10;Нельзя отклонить пояснительную записку, ничего не сказав студенту."
                          tableName="HIVE_REJECTION_OF_STATEMENT_OF_EXPLANATION"/>
    </changeSet>
    <changeSet id="46" author="hive">
        <setColumnRemarks columnDataType="uuid" columnName="MISDEMEANOR_ID"
                          remarks="Проступок студента. Теоретически, несколько сотрудников могут пометить флагом проступок. Поэтому many-to-one."
                          tableName="HIVE_FLAGGED_MISDEMEANOR"/>
    </changeSet>
    <changeSet id="47" author="hive">
        <setColumnRemarks columnDataType="uuid" columnName="MISDEMEANOR_ID" remarks="Ссылка на проступок."
                          tableName="HIVE_PROMISE"/>
    </changeSet>
    <changeSet id="48" author="hive">
        <setColumnRemarks columnDataType="uuid" columnName="MISDEMEANOR_ID" remarks="Ссылка на проступок."
                          tableName="HIVE_REPRIMAND"/>
    </changeSet>
    <changeSet id="49" author="hive">
        <setColumnRemarks columnDataType="uuid" columnName="MISDEMEANOR_ID" remarks="Ссылка на проступок."
                          tableName="HIVE_STATEMENT_OF_EXPLANATION"/>
    </changeSet>
    <changeSet id="50" author="hive">
        <setColumnRemarks columnDataType="uuid" columnName="PROMISE_ID" remarks="Ссылка на проступок."
                          tableName="HIVE_PERMIT_TO_PROMISE"/>
    </changeSet>
    <changeSet id="51" author="hive">
        <setColumnRemarks columnDataType="uuid" columnName="PROMISE_ID" remarks="Ссылка на обещание."
                          tableName="HIVE_REJECTION_OF_PROMISE"/>
    </changeSet>
    <changeSet id="52" author="hive">
        <setColumnRemarks columnDataType="uuid" columnName="STUDENT_ID" remarks="Ссылка на студента."
                          tableName="HIVE_PROMISE"/>
    </changeSet>
    <changeSet id="53" author="hive">
        <setColumnRemarks columnDataType="uuid" columnName="STUDENT_ID" remarks="Ссылка на студента."
                          tableName="HIVE_STATEMENT_OF_EXPLANATION"/>
    </changeSet>
    <changeSet id="54" author="hive">
        <setColumnRemarks columnDataType="varchar(1000)" columnName="TEXT" remarks="Типовой текст обещания студента."
                          tableName="HIVE_OATH"/>
    </changeSet>
    <changeSet id="55" author="hive">
        <setColumnRemarks columnDataType="clob" columnName="TEXT"
                          remarks="Текст обещания. Сам текст неважен: он не пойдет в характеристику и т.п.&#10;Наличие текста - важно: мы все-таки хотим выслушать студента.&#10;И важен сам факт обещания."
                          tableName="HIVE_PROMISE"/>
    </changeSet>
    <changeSet id="56" author="hive">
        <setColumnRemarks columnDataType="clob" columnName="TEXT" remarks="Текст объяснительной записки студента."
                          tableName="HIVE_STATEMENT_OF_EXPLANATION"/>
    </changeSet>
    <changeSet id="57" author="hive">
        <setColumnRemarks columnDataType="int" columnName="TIME_FOR_STUDENT_TO_REACT"
                          remarks="Время, в течение которого студент может&#10;отреагировать на факт фиксации его проступка.&#10;В часах."
                          tableName="HIVE_SETTINGS"/>
    </changeSet>
    <changeSet id="58" author="hive">
        <setColumnRemarks columnDataType="uuid" columnName="USER_ID" remarks="Пользователь." tableName="HIVE_STUDENT"/>
    </changeSet>
</databaseChangeLog>