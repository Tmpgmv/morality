<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd"
        objectQuotingStrategy="QUOTE_ONLY_RESERVED_WORDS">
    <changeSet id="1" author="hive">
        <createTable tableName="HIVE_REPRIMAND">
            <column name="ID" type="UUID">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_HIVE_REPRIMAND"/>
            </column>
            <column name="MISDEMEANOR_ID" type="UUID">
                <constraints nullable="false"/>
            </column>
            <column name="EMPLOYEE_ID" type="UUID">
                <constraints nullable="false"/>
            </column>
            <column name="COMMENT_" type="CLOB"/>
            <column name="CREATED_AT" type="DATETIME">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="2" author="hive">
        <createTable tableName="HIVE_WARNING">
            <column name="ID" type="UUID">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_HIVE_WARNING"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="3" author="hive">
        <addColumn tableName="HIVE_ACCEPTANCE_OF_STATMENT_OF_EXPLANATION">
            <column name="STATEMENT_OF_EXPLANATION_ID" remarks="Объяснительная записка студента." type="UUID"/>
        </addColumn>

        <addNotNullConstraint columnName="STATEMENT_OF_EXPLANATION_ID"
                              tableName="HIVE_ACCEPTANCE_OF_STATMENT_OF_EXPLANATION"/>
    </changeSet>
    <changeSet id="4" author="hive">
        <createIndex indexName="IDX_HIVEACCEPTANCEOFSTATMENTOFEXPLANATIO_STATEMENTOFEXPLANATION"
                     tableName="HIVE_ACCEPTANCE_OF_STATMENT_OF_EXPLANATION">
            <column name="STATEMENT_OF_EXPLANATION_ID"/>
        </createIndex>

        <addForeignKeyConstraint baseColumnNames="STATEMENT_OF_EXPLANATION_ID"
                                 baseTableName="HIVE_ACCEPTANCE_OF_STATMENT_OF_EXPLANATION"
                                 constraintName="FK_HIVEACCEPTANCEOFSTATMENTOFEXPLANAT_ON_STATEMENTOFEXPLANATION"
                                 referencedColumnNames="ID" referencedTableName="HIVE_STATEMENT_OF_EXPLANATION"/>
    </changeSet>
    <changeSet id="5" author="hive">
        <createIndex indexName="IDX_HIVE_REPRIMAND_EMPLOYEE" tableName="HIVE_REPRIMAND">
            <column name="EMPLOYEE_ID"/>
        </createIndex>

        <addForeignKeyConstraint baseColumnNames="EMPLOYEE_ID" baseTableName="HIVE_REPRIMAND"
                                 constraintName="FK_HIVE_REPRIMAND_ON_EMPLOYEE" referencedColumnNames="ID"
                                 referencedTableName="HIVE_USER"/>
    </changeSet>
    <changeSet id="6" author="hive">
        <createIndex indexName="IDX_HIVE_REPRIMAND_MISDEMEANOR" tableName="HIVE_REPRIMAND">
            <column name="MISDEMEANOR_ID"/>
        </createIndex>

        <addForeignKeyConstraint baseColumnNames="MISDEMEANOR_ID" baseTableName="HIVE_REPRIMAND"
                                 constraintName="FK_HIVE_REPRIMAND_ON_MISDEMEANOR" referencedColumnNames="ID"
                                 referencedTableName="HIVE_MISDEMEANOR"/>
    </changeSet>
    <changeSet id="7" author="hive">
        <dropColumn columnName="comment_" tableName="hive_flagged_misdemeanor"/>
    </changeSet>
    <changeSet id="8" author="hive">
        <setTableRemarks
                remarks="Признание обоснованности доводов, изложенных в объяснительной записке студента.&#10;Т.е. полное освобождение от наказания. Не будет даже предупреждения."
                tableName="HIVE_ACCEPTANCE_OF_STATMENT_OF_EXPLANATION"/>
    </changeSet>
    <changeSet id="9" author="hive">
        <setTableRemarks remarks="Прощение. В характеристику упомянутый в обещании проступок не попадет."
                         tableName="HIVE_MERCY"/>
    </changeSet>
    <changeSet id="10" author="hive">
        <setTableRemarks
                remarks="Коллекция типовых обещаний.В этой коллекции желательно иметь&#10;пословицы и поговорки. Например, &quot;Мое слово тверже гороха&quot;.&#10;Пользователи увидят такие тексты. И это позволит все-таки немножко разрядить&#10;обстановку."
                tableName="HIVE_OATH"/>
    </changeSet>
    <changeSet id="11" author="hive">
        <setTableRemarks
                remarks="На случай, етудент упустил время отреагировать на обвинение. Разрешить ему это сделать."
                tableName="HIVE_PERMIT_TO_PROMISE"/>
    </changeSet>
    <changeSet id="12" author="hive">
        <setColumnRemarks columnDataType="clob" columnName="CASE_SUMMARY"
                          remarks="В чем заключается проступок.&#10;Допустим, пропуск такого-то занятия такого-то числа."
                          tableName="HIVE_MISDEMEANOR"/>
    </changeSet>
    <changeSet id="13" author="hive">
        <setColumnRemarks columnDataType="clob" columnName="COMMENT_" remarks="Комментарий." tableName="HIVE_MERCY"/>
    </changeSet>
    <changeSet id="14" author="hive">
        <setColumnRemarks columnDataType="datetime" columnName="CREATED_AT" remarks="Время создания."
                          tableName="HIVE_ACCEPTANCE_OF_STATMENT_OF_EXPLANATION"/>
    </changeSet>
    <changeSet id="15" author="hive">
        <setColumnRemarks columnDataType="datetime" columnName="CREATED_AT" remarks="Время создания."
                          tableName="HIVE_MERCY"/>
    </changeSet>
    <changeSet id="16" author="hive">
        <setColumnRemarks columnDataType="uuid" columnName="EMPLOYEE_ID" remarks="Сотрудник."
                          tableName="HIVE_ACCEPTANCE_OF_STATMENT_OF_EXPLANATION"/>
    </changeSet>
    <changeSet id="17" author="hive">
        <setColumnRemarks columnDataType="uuid" columnName="EMPLOYEE_ID" remarks="Ссылка на сотрудника."
                          tableName="HIVE_MERCY"/>
    </changeSet>
    <changeSet id="18" author="hive">
        <setColumnRemarks columnDataType="uuid" columnName="PROMISE_ID" remarks="Ссылка на обещание студента."
                          tableName="HIVE_MERCY"/>
    </changeSet>
    <changeSet id="19" author="hive">
        <setColumnRemarks columnDataType="uuid" columnName="STUDENT_ID" remarks="Студент, совершивший проступок."
                          tableName="HIVE_MISDEMEANOR"/>
    </changeSet>
    <changeSet id="20" author="hive">
        <setColumnRemarks columnDataType="uuid" columnName="TYPE_ID"
                          remarks="Ссылка на тип проступка, т.е. что это (прогул, опоздание и т.п.)."
                          tableName="HIVE_MISDEMEANOR"/>
    </changeSet>
</databaseChangeLog>